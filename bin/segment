#!/usr/bin/env python

import sys
import argparse
import os

parser = argparse.ArgumentParser(description='segment: chop & analyze a/v')

parser.add_argument(
    '--audio', default=False, action='store_true',
    help='analyze audio')
parser.add_argument(
    '--novideo', default=False, action='store_true',
    help='only analyze audio')
parser.add_argument(
    '--outdir', default='',
    help='location for analysis to be stored')


parser.add_argument(
    'files', nargs='+',
    help='file to analyze')

args = parser.parse_args()

import segment.video as v
import segment.images as i

for f in args.files:
    print 'segmenting %s' % (f)

    fdir = os.path.join(args.outdir, os.path.basename(f) + '.analysis')

    if args.audio:
        import segment.audio as a
        a.serialize(f, fdir)
    if not args.novideo:
        tdir = os.path.join(args.outdir, '.' + os.path.basename(f) + '.analysis_in_progress')
        if os.path.isdir(f):
            i.serialize(f, tdir)
        else:
            v.serialize(f, tdir)

        os.rename(tdir, fdir)
